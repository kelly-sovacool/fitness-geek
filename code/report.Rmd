---
title: "Activity Report"
author: "Kelly Sovacool"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output:
  html_document:
    toc: true
    toc_float: true
github-repo: kelly-sovacool/strava
---

View the source code on GitHub: [kelly-sovacool/strava](https://github.com/kelly-sovacool/strava)

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(here)
library(knitr)
library(rmarkdown)
library(scales)
source(here::here("code", "read_processed_data.R"))
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
```

## Summary

```{r}
act_data <- read_data(here::here("data", "processed", "activities.csv"))
set_colors <- function(data) {
    palette = RColorBrewer::brewer.pal(n = 8, name = "Paired")
    colors = list()
    colors[["Ride"]] <- palette[[4]]
    colors[["Run"]] <- palette[[8]]
    colors[["RockClimbing"]] <- palette[[3]]
    colors[["Rowing"]] <- palette[[1]]
    colors[["Swim"]] <- palette[[2]]
    colors[["Hike"]] <- palette[[6]]
    colors[["Walk"]] <- palette[[5]]
    colors[["Elliptical"]] <- palette[[7]]
    colors
}
colors <- set_colors(act_data)
table <- act_data %>%
    group_by(year, type) %>%
    summarize(n=n(),
              sum_dist_mi=round(sum(distance_mi),1),
              med_dist_mi=round(median(distance_mi), 1),
              sum_time_hrs=sum(elapsed_time_hrs),
              med_time_hrs=median(elapsed_time_hrs))
knitr::kable(table)
```

## Progress over time

### Distance

```{r}
# sum
table %>%
    filter(type %in% c("Ride", "Run")) %>%
    ggplot(aes(year, sum_dist_mi, fill=type, label=sum_dist_mi)) +
    geom_col(position="dodge") +
    geom_text(vjust=-0.3, position = position_dodge(width=1)) +
    scale_fill_manual("type", values=colors) +
    facet_wrap(~type, nrow=1) +
    scale_y_continuous(breaks=pretty_breaks()) +
    ggtitle("Total Distance (mi) by year") +
    theme_classic()
# jitter
knitr::include_graphics(here::here("figures", "jitter_dist_year.png"))
```

### Duration
```{r}
# sum
table %>%
    filter(type %in% c("Ride", "Run")) %>%
    ggplot(aes(year, sum_time_hrs, fill=type, label=sum_time_hrs)) +
    geom_col(position="dodge") +
    geom_text(vjust=-0.3, position = position_dodge(width=1)) +
    scale_fill_manual("type", values=colors) +
    facet_wrap(~type, nrow=1) +
    scale_y_continuous(breaks=pretty_breaks()) +
    ggtitle("Total Time (hrs) by year") +
    theme_classic()
# jitter
knitr::include_graphics(here::here("figures", "jitter_time_year.png"))
```

#### By month

```{r}
knitr::include_graphics(here::here("figures", "bar_all_month.png"))
```

#### By week

```{r}
knitr::include_graphics(here::here("figures", "bar_all_week.png"))
```

#### By day

```{r}
knitr::include_graphics(here::here("figures", "bar_all_day.png"))
```


## Duration by activity

```{r}
knitr::include_graphics(here::here("figures", "jitter_type_time.png"))
```

### Day of the week

```{r}
knitr::include_graphics(here::here("figures", "box_weekday_time.png"))
knitr::include_graphics(here::here('figures', "jitter_weekday_time_grid.png"))
```

## Distance by activity

```{r}
knitr::include_graphics(here::here("figures", "jitter_type_dist_log2.png"))
```

### Day of the week
```{r}
knitr::include_graphics(here::here("figures", "box_weekday_dist_wrap.png"))
knitr::include_graphics(here::here('figures', "jitter_weekday_dist_grid.png"))
```

## Cumulative

```{r}
knitr::include_graphics(here::here("figures", "line_time.png"))
knitr::include_graphics(here::here("figures", "line_dist.png"))
```
